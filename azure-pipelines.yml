trigger:
- main

pool:
  name: 'Pi Router'

steps:
# 1. Ensure the directory exists and copy files
- pwsh: |
    # Ensure the target directory exists
    New-Item -ItemType Directory -Force -Path /home/pgj99/code/PiRouter

    # Copy everything from the checkout directory to the target
    # -Recurse handles subfolders, -Force overwrites existing files
    Copy-Item -Path "$(System.DefaultWorkingDirectory)/*" `
              -Destination /home/pgj99/code/PiRouter `
              -Recurse `
              -Force
  displayName: 'Sync files to PiRouter folder'

# 2. Run Docker Compose
- pwsh: |
    cd /home/pgj99/code/PiRouter
    docker compose up -d --build
  displayName: 'Docker Compose Up'